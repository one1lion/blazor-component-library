@namespace One1Lion.Card
@using System.Drawing

@implements ICard
@implements IHandleChildStateChanges

<CascadingValue Value=this>
    @ChildContent

    <div class="@CssClasses" style="@ColorOverrides" @attributes=AdditionalAttributes>
        @if (_header is not null)
        {
            @_header.RenderContent
        }

        @if (_body is not null)
        {
            @_body.RenderContent
        }

        @if (_footer is not null)
        {
            @_footer.RenderContent
        }
    </div>
</CascadingValue>

@code {
    [Parameter] public RenderFragment ChildContent { get; set; }
    [Parameter] public ElevationLevel ElevationLevel { get; set; } = ElevationLevel.Low;
    [Parameter] public bool Outlined { get; set; }
    [Parameter] public bool Filled { get; set; }
    [Parameter] public Color? ShadowColor { get; set; }
    [Parameter] public Color? OutlineColor { get; set; }
    [Parameter] public Color? FillColor { get; set; }
    [Parameter] public string AddCssClasses { get; set; }
    [Parameter(CaptureUnmatchedValues = true)]
    public IDictionary<string, object> AdditionalAttributes { get; set; }

    public string CssClasses => $"o1l-card elevated-{(int)ElevationLevel}{(Outlined ? $" outlined" : string.Empty)}{(Filled ? $" filled" : string.Empty)}{(string.IsNullOrWhiteSpace(AddCssClasses) ? string.Empty : $" {AddCssClasses}")}";
    public string ColorOverrides => $"{(ShadowColor.HasValue ? $"--o1l-shadow-color: rgba({ShadowColor.Value.R},{ShadowColor.Value.G},{ShadowColor.Value.B},{ShadowColor.Value.A / 255.0f});" : string.Empty)}{(OutlineColor.HasValue ? $"--o1l-outline-color: rgba({OutlineColor.Value.R},{OutlineColor.Value.G},{OutlineColor.Value.B},{OutlineColor.Value.A / 255.0f});" : string.Empty)}{(FillColor.HasValue ? $"--o1l-fill-color: rgba({FillColor.Value.R},{FillColor.Value.G},{FillColor.Value.B},{FillColor.Value.A / 255.0f});" : string.Empty)}";

    private CardBody _body = default!;

    public void AddBody(CardBody body)
    {
        _body = body;
        StateHasChanged();
    }

    private CardHeader _header;
    public void SetHeader(CardHeader header)
    {
        _header = header;
        StateHasChanged();
    }

    private CardFooter _footer;
    public void SetFooter(CardFooter footer)
    {
        _footer = footer;
        StateHasChanged();
    }

    public void ChildStateChanged()
    {
        StateHasChanged();
    }
}
